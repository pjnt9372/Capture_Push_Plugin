name: æ„å»ºæ’ä»¶å‘å¸ƒ

on:
  # æ‰‹åŠ¨è§¦å‘ï¼Œæ”¯æŒä¼ å‚
  workflow_dispatch:
    inputs:
      school_code:
        description: 'å­¦æ ¡ä»£ç  (å¦‚: 10546)'
        required: true
        default: '12345'
      school_name:
        description: 'å­¦æ ¡åç§° (å¦‚: æŸæŸå¤§å­¦)'
        required: true
        default: 'æŸæŸå¤§å­¦'
      contributor:
        description: 'è´¡çŒ®è€…åç§°'
        required: true
        default: 'Anonymous'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ›ï¸ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: ğŸ è®¾ç½® Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.x' # ä½¿ç”¨æœ€æ–°ç‰ˆ Python

    - name: ğŸ—ï¸ è¿è¡Œæ„å»ºè„šæœ¬
      id: build
      run: |
        # ä½¿ç”¨ here-document æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥ï¼Œå°† GitHub å‚æ•°ä¼ é€’ç»™è„šæœ¬
        python build_plugin.py << EOF
        ${{ github.event.inputs.school_code }}
        ${{ github.event.inputs.school_name }}
        ${{ github.event.inputs.contributor }}
        
        EOF

    - name: ğŸ“¤ å‘å¸ƒè‡³ Release (plugin/latest)
      # å¼•ç”¨æµè¡Œçš„ release action
      uses: softprops/action-gh-release@v2
      if: ${{ always() }} # å³ä½¿æ„å»ºå¤±è´¥ä¹Ÿå°è¯•å‘å¸ƒæ—¥å¿—ï¼ˆå¯é€‰ï¼‰
      with:
        # å…³é”®ï¼šæŒ‡å®šæ ‡ç­¾ä¸º plugin/latest
        tag_name: plugin/latest
        # å…³é”®ï¼šå‘å¸ƒç”Ÿæˆçš„ä¸¤ä¸ªæ–‡ä»¶
        # å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼ŒGitHub ä¼šè‡ªåŠ¨æ›¿æ¢ï¼Œå®ç°â€œä¸ä¿ç•™å†å²æ–‡ä»¶â€
        files: |
          school_${{ github.event.inputs.school_code }}_plugin.zip
          plugins_index.json
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
